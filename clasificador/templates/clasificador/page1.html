{% extends 'clasificador/encabezado.html' %}
{% load static %}
{% block content %}
<title>Monitoreo de plantas</title>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Care Plant</title>
    <link rel="stylesheet" href="{% static 'css/styles2.css' %}">
</head>

<div class="page-container">

    <!-- T√≠tulo principal -->
    <div class="main-title">Monitoreo de plantas</div>

    <!-- Secci√≥n de par√°metros de riego -->
    <section class="riego-container">
        <div class="plant-image">
            <!-- Video stream -->
            <img id="videoStream" 
         src="{% url 'video_feed' %}" 
         alt="No camera" 
         data-placeholder="https://png.pngtree.com/png-vector/20221116/ourmid/pngtree-no-camera-red-sign-png-image_6459860.png">

            <!-- üîò Bot√≥n para controlar la c√°mara -->
            <button id="toggleCameraBtn" class="toggle-btn">Apagar c√°mara</button>
        </div>
        
        <div class="riego-info">
            <div class="plant-name"></div>
            <div class="section-title">Par√°metros de Cuidados</div>
            
            <div class="params-grid">
                <div class="param-row">
                    <div class="param-label">Temperatura</div>
                    <div class="param-box"></div>
                    <div class="icon-btn"></div>
                </div>
                
                <div class="param-row">
                    <div class="param-label">humedad del suelo</div>
                    <div class="param-box"></div>
                    <div class="icon-btn"></div>
                </div>
                
                <div class="param-row">
                    <div class="param-label">Ph del suelo</div>
                    <div class="param-box"></div>
                    <div class="icon-btn"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Secci√≥n de informaci√≥n de la especie -->
    <section class="species-container">
        <div class="species-title">Un poco sobre la especie</div>

        <div class="species-image">
            <img src="https://images.unsplash.com/photo-1614594975525-e45190c55d0b?w=280&h=320&fit=crop" alt="Epipremnum aureum">
        </div>
        
        <div class="species-info">
            <div class="species-name">Epipremnum aureum</div>
            <div class="species-text">
                Epipremnum aureum, com√∫nmente conocido como potus, pothos o poto, es una especie de la familia Araceae nativa del sudeste asi√°tico y Nueva Guinea. En ocasiones es confundida con philodendron.
            </div>
            <div class="species-reference">
                Informaci√≥n basada en: <a href="https://es.wikipedia.org/wiki/Epipremnum_aureum" target="_blank">Wikipedia</a>
            </div>
        </div>
    </section>

    <!-- Script para actualizar nombre -->
    <script>
        function updatePlantInfo() {
    fetch("{% url 'get_plant_data' %}")
    .then(response => response.json())
    .then(data => {
        // üåø Nombre de la planta
        const plantNameDiv = document.querySelector('.plant-name');
        if (data.label) {
            plantNameDiv.textContent = `${data.label} (${(data.prob * 100).toFixed(1)}%)`;
        } else {
            plantNameDiv.textContent = "Detectando...";
        }

        // üå°Ô∏è Par√°metros
        document.querySelectorAll('.param-row')[0].querySelector('.param-box').textContent = data.temperatura;
        document.querySelectorAll('.param-row')[1].querySelector('.param-box').textContent = data.humedad;
        document.querySelectorAll('.param-row')[2].querySelector('.param-box').textContent = data.estado;

        // ü™¥ Informaci√≥n de la especie
        document.querySelector('.species-name').textContent = data.label;
        document.querySelector('.species-text').textContent = data.descripcion;
        document.querySelector('.species-image img').src = data.imagen;
        document.querySelector('.species-reference a').href = data.referencia;
        document.querySelector('.species-reference a').textContent = data.referencia;
    })
    .catch(error => console.error('Error al obtener los datos de la planta:', error));
    }

// Actualiza cada 2 segundos
    setInterval(updatePlantInfo, 2000);
    </script>

    <!-- Script para encender/apagar c√°mara -->
   <script>
    const video = document.getElementById('videoStream');
    const toggleBtn = document.getElementById('toggleCameraBtn');
    let cameraOn = true; // La c√°mara empieza encendida

    toggleBtn.addEventListener('click', () => {
        if (cameraOn) {
            // üî¥ Apagar c√°mara ‚Üí mostrar imagen de "no c√°mara"
            video.src = video.dataset.placeholder;
            toggleBtn.textContent = "Encender c√°mara";
            cameraOn = false;
        } else {
            // üü¢ Encender c√°mara ‚Üí restaurar streaming
            video.src = "{% url 'video_feed' %}";
            toggleBtn.textContent = "Apagar c√°mara";
            cameraOn = true;
        }
    });
</script>

</div>
{% endblock content %}
